(function(a,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(a=typeof globalThis<"u"?globalThis:a||self,s(a.Testpress={}))})(this,function(a){"use strict";var c=Object.defineProperty;var u=(a,s,i)=>s in a?c(a,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[s]=i;var o=(a,s,i)=>(u(a,typeof s!="symbol"?s+"":s,i),i);function s(l){return Boolean(l instanceof Element&&l.nodeName=="IFRAME")}function i(l,e){return l.indexOf(e.toLowerCase())===0?l:`${e.toLowerCase()}${l.substr(0,1).toUpperCase()}${l.substr(1)}`}let h=new WeakMap;class d{constructor(e){o(this,"iframe");o(this,"iframeReadyPromise");o(this,"metaDataLoadedPromise");o(this,"window");o(this,"callbackMap",new Map);o(this,"onMessage",e=>{!this.isMessageFromEmbededPlayer(e)||(e.data.event?this.handleEventResponse(e.data):e.data.method?this.handleMethodResponse(e.data):e.data.type==="overlayAction"&&this.handleOverlayActionResponse(e.data))});if(h.has(e))return h.get(e);this.validateIframeElement(e),this.prepareIframeReadyPromise(),this.prepareMetaDataLoadedPromise(),this.initialize(e)}validateIframeElement(e){this.raiseErrorIfItsNotIframe(e),this.raiseErrorIfIframeNotAttachedWithDOM(e)}raiseErrorIfItsNotIframe(e){if(!s(e))throw new Error("You must pass valid iframe element")}raiseErrorIfIframeNotAttachedWithDOM(e){if(!e.isConnected)throw new Error("Iframe element must be attached with the DOM")}prepareIframeReadyPromise(){this.iframeReadyPromise=new Promise((e,t)=>{this.storeCallback("event:loadeddata",{resolve:e,reject:t})})}prepareMetaDataLoadedPromise(){this.metaDataLoadedPromise=new Promise((e,t)=>{this.storeCallback("event:loadedmetadata",{resolve:e,reject:t})})}initialize(e){this.iframe=e,this.window=e.ownerDocument.defaultView,h.set(this.iframe,this),this.window.addEventListener("message",this.onMessage)}isMessageFromEmbededPlayer(e){var t;return((t=this.iframe)==null?void 0:t.contentWindow)===e.source}handleEventResponse(e){this.getCallbacks(`event:${e.event}`).forEach(r=>{typeof r=="function"?r.apply(void 0,e.values):this.handlePromiseCallback(e,r)})}handlePromiseCallback(e,t){e.status==="success"?t.resolve():t.reject(e.error)}handleMethodResponse(e){const t=this.popFirstCallback(e.method);t&&(e.status==="success"?t.resolve(e.value):t.reject(e.error))}play(){return this.callMethod("play")}pause(){return this.callMethod("pause")}isFullscreen(){return this.callMethod("isFullscreen")}setEndScreenImage(e){return this.callMethod("setEndScreenImage",e)}setPlayerUserId(e){return this.callMethod("setPlayerUserId",e)}setCurrentTime(e){return this.set("currentTime",e)}getCurrentTime(){return this.get("currentTime")}getLoop(){return this.get("loop")}setLoop(e){return this.set("loop",e)}getMuted(){return this.get("muted")}setMuted(e){return this.set("muted",e)}getAutoPlay(){return this.get("autoplay")}setAutoPlay(e){return this.set("autoplay",e)}getPlaybackRates(){return this.get("playbackRates")}setPlaybackRate(e){this.set("playbackRate",e)}getPlaybackRate(){return this.get("playbackRates")}getCurrentPlaybackRate(){return this.callMethod("getCurrentPlaybackRate")}enableFullscreen(){return this.callMethod("enableFullscreen")}disableFullscreen(){return this.callMethod("disableFullscreen")}requestFullscreen(){return this.callMethod("requestFullscreen")}exitFullscreen(){return this.callMethod("exitFullscreen")}getWatchedTime(){return this.callMethod("getWatchedTime")}getVolume(){return this.get("volume")}getPaused(){return this.get("paused")}getEnded(){return this.get("ended")}setVolume(e){this.set("volume",e)}applyWatermark(e){return this.callMethod("applyWatermark",e)}played(){return this.callMethod("played")}setMarkers(e){return this.set("markers",e)}removeMarkers(e){return this.callMethod("removeMarkers",e)}removeAllMarkers(){return this.callMethod("removeAllMarkers")}getDuration(){return this.getMetaData("duration")}setCustomErrorMessage(e){return this.callMethod("setCustomErrorMessage",e)}clearCustomErrorMessage(){return this.callMethod("clearCustomErrorMessage")}setDRMURL(e){return this.callMethod("setDRMURL",e)}set(e,t){return this.raiseErrorIfValueIsEmpty(t),this.callMethod(i(e,"set"),t)}raiseErrorIfValueIsEmpty(e){if(e==null)throw new TypeError("There must be a value to set.")}get(e){return this.callMethod(i(e,"get"))}on(e,t){this.raiseErrorifEventNameIsEmpty(e),this.raiseErrorIfCallbackIsEmpty(t),this.raiseErrorIfCallbackIsNotAFunction(t),this.addListenerToPlayer(e),this.storeCallback(`event:${e}`,t)}addListenerToPlayer(e){this.isEventHasBeenListened(e)||this.callMethod("addEventListenerToPlayer",e)}isEventHasBeenListened(e){return this.getCallbacks(`event:${e}`).length!==0}off(e,t){this.raiseErrorifEventNameIsEmpty(e),this.raiseErrorIfCallbackIsNotAFunction(t),this.removeCallback(`event:${e}`,t),this.removeListenerFromPlayer(e)}removeListenerFromPlayer(e){this.isEventHasBeenListened(e)||this.callMethod("removeEventListenerFromPlayer",e)}raiseErrorifEventNameIsEmpty(e){if(!e)throw new TypeError("You must pass an event name.")}raiseErrorIfCallbackIsEmpty(e){if(!e)throw new TypeError("You must pass a callback function.")}raiseErrorIfCallbackIsNotAFunction(e){if(e&&typeof e!="function")throw new TypeError("The callback must be a function.")}callMethod(e,t=void 0){return new Promise((r,n)=>{this.loaded().then(()=>{this.storeCallback(e,{resolve:r,reject:n}),this.postMessage({methodName:e,argument:t})}).catch(n)})}storeCallback(e,t){var r;this.callbackMap.has(e)?(r=this.callbackMap.get(e))==null||r.push(t):this.callbackMap.set(e,[t])}popFirstCallback(e){const t=this.getCallbacks(e);if(t.length>=1)return t.shift()}removeCallback(e,t){!this.callbackMap.has(e)||(t?this.removeSpeficCallback(e,t):this.removeAllCallbacks(e))}removeAllCallbacks(e){this.callbackMap.set(e,[])}removeSpeficCallback(e,t){const r=this.callbackMap.get(e).indexOf(t);r!==-1&&this.callbackMap.get(e).splice(r,1)}getCallbacks(e){return this.callbackMap.get(e)||[]}postMessage(e){var t,r;(r=(t=this.iframe)==null?void 0:t.contentWindow)==null||r.postMessage(e,"*")}loaded(){return Promise.resolve(this.iframeReadyPromise)}getMetaData(e){let t=i(e,"get");return new Promise((r,n)=>{this.metaDataLoaded().then(()=>{this.storeCallback(t,{resolve:r,reject:n}),this.postMessage({methodName:t})}).catch(n)})}showOverlay(e){this.callMethod("showOverlay",e)}handleOverlayActionResponse(e){this.getCallbacks("event:overlayAction").forEach(r=>{typeof r=="function"&&r(e)})}metaDataLoaded(){return Promise.resolve(this.metaDataLoadedPromise)}}a.Player=d,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
